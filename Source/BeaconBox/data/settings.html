<!DOCTYPE html>
<html>
	<head>
    	<title>[BeaconBox]</title>
    	<link rel="stylesheet" type="text/css" href="styles.css" media="all" />

    	<meta charset="UTF-8">
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">

    	<script type="text/javascript" src="jquery-3.2.1.min.js"></script>
    	<script type="text/javascript" src="support.js"></script>

    	<script type="text/javascript">

			function updateForm() {

    			// Get the form data

    			$.ajax({
        			url: "getSettingsData"
    			}).done(function (data) {

        			// We have the data, display it.

        			var settingsData = data.documentElement;
        			$("#hostnameInput").val(settingsData.getAttribute("Hostname"));
        			$("#ssidInput").val(settingsData.getAttribute("WiFiSSID"));
        			$("#passwordInput").val(settingsData.getAttribute("WiFiPassword"));
        			$("#callsignInput").val(settingsData.getAttribute("Callsign"));
        			$("#spotterWildcardsInput").val(settingsData.getAttribute("SpotterWildcards"));
        			$("#spotterTimeOutMinutesInput").val(settingsData.getAttribute("SpotterTimeOutMinutes"));
        			$("#frequencyStepTimeSecondsInput").val(settingsData.getAttribute("FrequencyStepTimeSeconds"));
        			$("#ledBrightnessInput").val(settingsData.getAttribute("LEDBrightness"));

    			}).fail(function (jqXHR, textStatus) {

        			alert("Contact with host lost! " + textStatus);
    			});
			}

        	// At this point the page is running

        	$(document).ready(function () {

            	// Do we need to hide the refresh button?

            	var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

            	if (true === isSafari)
                	$('#refreshRow').hide();

            	// Populate the spotterTimeOut drop down

            	var select = $("#spotterTimeOutMinutesInput");
	            for (var i = 1; i < 31; i++) {
					$("<option/>", { value: i, text: i }).appendTo(select);
				}

            	// Populate the frequencyStepTime drop down

            	var select = $("#frequencyStepTimeSecondsInput");
	            for (var i = 1; i < 121; i++) {
					$("<option/>", { value: i, text: i }).appendTo(select);
				}

            	// Populate the ledBrightness drop down

            	var select = $("#ledBrightnessInput");
	            for (var i = 1; i < 256; i++) {
					$("<option/>", { value: i, text: i }).appendTo(select);
				}

            	updateNameVersion();
            	updateForm();
            	updateSSIDs();

            	var coll = document.getElementsByClassName("collapsible");

				for (var i = 0; i < coll.length; i++) {
				  coll[i].addEventListener("click", function() {
				    this.classList.toggle("active");
				    var content = this.nextElementSibling;
				    if (content.style.display === "block") {
				      content.style.display = "none";
				    } else {
				      content.style.display = "block";
				    }
  				});
  				}

        	});

    	</script>
	</head>
    	<body>
        	<div class='norm'>

            	<h1>
                	<span id="programName">[programName]</span>&nbsp;<span id="programVersion">[programVersion]</span>
            	</h1>

            	<button id="homeButton" onclick="window.location.href='index.html';">Home</button>
            	<button id="reverseBeaconNetworkDataButton" onclick="window.location.href='reverseBeaconNetworkData.html';">Reverse Beacon Network Data</button>
            	<button id="settingsButton" onclick="window.location.href='settings.html';">Settings</button>
            	<button id="aboutButton" onclick="window.location.href='about.html';">About</button>
            	<br />
            	<br />

            	<!-- Settings Div -->

            	<div id="settingsDiv">

                	<hr />

                	<h1>Settings</h1>

                	<form action="/doSettingsUpdate" method="get" style="margin-bottom:20px;">

                    	<fieldset>
                        	<legend>Wi-Fi</legend>

							<button type="button" class="collapsible">Click for help.</button>
							<div class="content">
							    <p>
							        BeaconBox reads data from the <a href='https://www.reversebeacon.net/'>Reverse Beacon Network</a>.
								    To do this it requires access to the Internet. The details should be completed to indicate the
								    Wi-Fi to connect to and the associated password.
								    <ul>
								        <li>
								            Hostname - The hostname can be set to provide the name that the BeaconBox will appear
								            as on your Wi-Fi network.
								        </li>
								        <li>
								            Wi-Fi SSID - The name of the Wi-Fi SSID to connect to.
								        </li>
								        <li>
								            Wi-Fi Password - The password associated with the Wi-Fi SSID to connect to.
								        </li>
								    </ul>
								  </p>
							</div>

                        	<table>
                            	<tr>
                                	<td>Hostname:</td>
                                	<td>
                                    	<input type="text" name="hostnameInput" id="hostnameInput" placeholder="Hostname" minlength="1" maxlength="15" />
                                	</td>
                            	</tr>

                            	<tr>
                                	<td>Wi-Fi SSID:</td>
                                	<td>
                                    	<input type="text" name="ssidInput" id="ssidInput" autocomplete="username" placeholder="32 characters maximum" minlength="1" maxlength="32" list="availableSSIDS" required />
                                    	<datalist id="availableSSIDS"></datalist>
                                	</td>
                            	</tr>

                            	<tr id="refreshRow">
                                	<td></td>
                                	<td>
                                    	<button type="button" id="refreshButton" onclick="updateSSIDs()">Refresh Available SSIDs</button>
                                	</td>
                            	</tr>

                            	<tr>
                                	<td>Wi-Fi Password:</td>
                                	<td>
                                    	<input type="password" name="passwordInput" id="passwordInput" autocomplete="current-password" placeholder="64 characters maximum" maxlength="64" />
                                	</td>
                            	</tr>

                        	</table>
                    	</fieldset>

                    	<br />

                    	<fieldset>
                        	<legend>Reverse Beacon Network</legend>

							<button type="button" class="collapsible">Click for help.</button>
							<div class="content">
							    <p>
								    <ul>
								        <li>
								            Callsign - The <a href='https://www.reversebeacon.net/'>Reverse Beacon Network</a>
								            prompts for a callsign that is used to identify the person reading the data. This
								            can be set to your callsign or just a simple name.
								        </li>
								    </ul>
						        </p>
							</div>

                        	<table>
                            	<tr>
                            	    <td>Callsign:</td>
                            	    <td>
                            	        <input type="text" name="callsignInput" id="callsignInput" placeholder="Callsign" minlength="1" maxlength="32" required />
                            	    </td>
                            	</tr>

                   	     	</table>
                  	  	</fieldset>

						<br />

                    	<fieldset>
                        	<legend>Spotters</legend>

							<button type="button" class="collapsible">Click for help.</button>
							<div class="content">
							    <p>
								    <ul>
								        <li>
								            Spotter Wildcards - This is a comma separated list of callsigns containing wildcards,
								            either *, or ?, that are compared against the Reverse Beacon Network "spotter" data
								            to determine if a beacon has been heard. The default value for this is G* which is
								            any station within the United Kingdom.
								        </li>
								        <li>
								            Spotter Time Out (Minutes) - Beacons spots time out. After this time the spot is ignored.
								            The default value for this is 5 minutes.
								        </li>
								        <li>
								            Frequency Step Time (Seconds) - This is the time, in seconds, that the beacons associated
								            with the active frequency remain visible. The default value for this is 5 seconds.
								        </li>
								    </ul>
						        </p>
							</div>

                        	<table>

                            	<tr>
                            	    <td>Spotter Wildcards:</td>
                            	    <td>
                            	        <input type="text" name="spotterWildcardsInput" id="spotterWildcardsInput" placeholder="Spotter Wildcards" minlength="1" maxlength="100" required />
                            	    </td>
                            	</tr>

                            	<tr>
                            	    <td>Spotter Time Out (Minutes):</td>
                            	    <td>
                            	    	<select name="spotterTimeOutMinutesInput" id="spotterTimeOutMinutesInput"></select>
                                   	</td>
                            	</tr>

                            	<tr>
                            	    <td>Frequency Step Time (Seconds):</td>
                            	    <td>
                            	    	<select name="frequencyStepTimeSecondsInput" id="frequencyStepTimeSecondsInput"></select>
                                   	</td>
                            	</tr>

                   	     	</table>
                  	  	</fieldset>

                    	<br />

                    	<fieldset>
                        	<legend>LED Display</legend>

							<button type="button" class="collapsible">Click for help.</button>
							<div class="content">
							    <p>
								    <ul>
								        <li>
								            LED Brightness - This controls the brightness of the LED display. This ranges
								            from 1 to 255 with 255 being the brightest.
								        </li>
								    </ul>
						        </p>
							</div>

                        	<table>

                            	<tr>
                            	    <td>LED Brighness (1 - 255) 255 being the brightest:</td>
                            	    <td>
                            	    	<select name="ledBrightnessInput" id="ledBrightnessInput"></select>
                                   	</td>
                            	</tr>

                   	     	</table>
                  	  	</fieldset>

                    	<br />

                    	<table>
                        	<tr>
                            	<td>Update</td>
                            	<td>
                                	<button>Update</button>
                            	</td>
                        	</tr>
                    	</table>
                	</form>
            	</div>
        	</div>
        <div id=footer>Copyright &copy; <span id="programCopyright"></span></div>
    </body>
</html>
